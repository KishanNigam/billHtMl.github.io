DECLARE @PRIOR_PERIOD Varchar(10), 
        @CURRENT_PERIOD Varchar(10), 
        @PRIOR_PERIOD2 Varchar(10), 
        @BASIS1 VARCHAR(50), 
        @BASIS2 VARCHAR(50), 
        @COMPANY_CODE VARCHAR(50), 
        @BU_CODE_SEG VARCHAR(50), 
        @BU_CODE_AGENT VARCHAR(50), 
        @BU_CODE_CLASS VARCHAR(50), 
        @BU_CODE_REINS VARCHAR(50), 
        @BU_CODE_AFFIL VARCHAR(50), 
        @BU_CODE_EXPG VARCHAR(50);

-- Assign values to the variables as needed
SET @PRIOR_PERIOD = '2000-01-31';  
SET @CURRENT_PERIOD = '2024-06-30';  
SET @PRIOR_PERIOD2 = '2024-01-31';  
SET @BASIS1 = 'GAAPC';  
SET @BASIS2 = 'STATC';  
SET @COMPANY_CODE = 'BHSIC';  
SET @BU_CODE_SEG = 'SEG';  
SET @BU_CODE_AGENT = 'AGENT';  
SET @BU_CODE_CLASS = 'CLASS';  
SET @BU_CODE_REINS = 'REINS';  
SET @BU_CODE_AFFIL = 'AFFIL';  
SET @BU_CODE_EXPG = 'EXPG';  

SELECT 
    BD.CAL_ACCTG_PERIOD, 
    BD.COMPANY_CODE,
    BD.ACCOUNT_NUMBER,
    AC.DESCRIPTION, 
    ISNULL(SD2.BU_CODE, @BU_CODE_SEG) AS SEG,
    ISNULL(SD3.BU_CODE, @BU_CODE_AGENT) AS AGENT,
    ISNULL(SD4.BU_CODE, @BU_CODE_CLASS) AS CLASS,
    ISNULL(SD5.BU_CODE, @BU_CODE_REINS) AS REINS,
    ISNULL(SD6.BU_CODE, @BU_CODE_AFFIL) AS AFFIL,
    ISNULL(SD7.BU_CODE, @BU_CODE_EXPG) AS EXPG,
    SUM(BD.CONVERTED_AMOUNT) AS 'BALANCE', 
    BH.STATUS_CODE,
    A.ACCTG_BASIS_CODE

FROM   
    [REPL_EAS].[dbo].BSTRN_HEADER BH 
    INNER JOIN [REPL_EAS].[dbo].BSTRN_DETAIL BD ON BH.TRAN_ID = BD.TRAN_ID 
    LEFT OUTER JOIN [REPL_EAS].[dbo].AP_BSTRN_HEADER AP ON BH.TRAN_ID = AP.TRAN_ID 
    INNER JOIN [REPL_EAS].[dbo].ACCT_BAS_ACCT_BAS A ON BD.ACCTG_BASIS_CODE = A.REL_ACCT_BAS_CODE
    LEFT OUTER JOIN [REPL_EAS].[dbo].BU_SET_DETAILS SD2 ON BD.BU_SET_ID = SD2.BU_SET_ID AND SD2.BU_TYPE = 'SEG'
    LEFT OUTER JOIN [REPL_EAS].[dbo].BU_SET_DETAILS SD3 ON BD.BU_SET_ID = SD3.BU_SET_ID AND SD3.BU_TYPE = 'AGENT'
    LEFT OUTER JOIN [REPL_EAS].[dbo].BU_SET_DETAILS SD4 ON BD.BU_SET_ID = SD4.BU_SET_ID AND SD4.BU_TYPE = 'CLASS'
    LEFT OUTER JOIN [REPL_EAS].[dbo].BU_SET_DETAILS SD5 ON BD.BU_SET_ID = SD5.BU_SET_ID AND SD5.BU_TYPE = 'REINS'
    LEFT OUTER JOIN [REPL_EAS].[dbo].BU_SET_DETAILS SD6 ON BD.BU_SET_ID = SD6.BU_SET_ID AND SD6.BU_TYPE = 'AFFIL'
    LEFT OUTER JOIN [REPL_EAS].[dbo].BU_SET_DETAILS SD7 ON BD.BU_SET_ID = SD7.BU_SET_ID AND SD7.BU_TYPE = 'EXPG'
    LEFT OUTER JOIN [REPL_EAS].[dbo].ACCOUNT AC ON BD.ACCOUNT_NUMBER = AC.ACCT_NUMBER AND BD.COMPANY_CODE = AC.COMPANY_CODE
 
WHERE   
    (BD.CAL_ACCTG_PERIOD BETWEEN @PRIOR_PERIOD AND @CURRENT_PERIOD AND A.ACCTG_BASIS_CODE IN (@BASIS1, @BASIS2) AND BD.COMPANY_CODE = @COMPANY_CODE AND AC.ACCT_CLASS_IND IN ('A','L','S','E','G')) 
    OR 
    (BD.CAL_ACCTG_PERIOD BETWEEN @PRIOR_PERIOD2 AND @CURRENT_PERIOD AND A.ACCTG_BASIS_CODE IN (@BASIS1, @BASIS2) AND BD.COMPANY_CODE = @COMPANY_CODE AND AC.ACCT_CLASS_IND IN ('I','X','F'))

GROUP BY
    BD.CAL_ACCTG_PERIOD, 
    BD.COMPANY_CODE,
    BD.ACCOUNT_NUMBER,
    AC.DESCRIPTION,
    ISNULL(SD2.BU_CODE, @BU_CODE_SEG),
    ISNULL(SD3.BU_CODE, @BU_CODE_AGENT),
    ISNULL(SD4.BU_CODE, @BU_CODE_CLASS),
    ISNULL(SD5.BU_CODE, @BU_CODE_REINS),
    ISNULL(SD6.BU_CODE, @BU_CODE_AFFIL),
    ISNULL(SD7.BU_CODE, @BU_CODE_EXPG),
    BH.STATUS_CODE,
    A.ACCTG_BASIS_CODE

ORDER BY 
    BD.ACCOUNT_NUMBER,
    BD.CAL_ACCTG_PERIOD;
