SELECT
    BD.CAL_ACCTG_PERIOD,
    BD.COMPANY_CODE,
    BD.ACCOUNT_NUMBER,
    AC.DESCRIPTION,
    SUM(BD.CONVERTED_AMOUNT) AS 'BALANCE',
    BH.STATUS_CODE,
    A.ACCTG_BASIS_CODE
FROM
    BSTRN_HEADER BH
INNER JOIN
    BSTRN_DETAIL BD ON BH.TRAN_ID = BD.TRAN_ID
INNER JOIN
    ACCT_BAS_ACCT_BAS A ON BD.ACCTG_BASIS_CODE = A.REL_ACCT_BAS_CODE
FULL OUTER JOIN
    ACCOUNT AC ON BD.ACCOUNT_NUMBER = AC.ACCT_NUMBER AND BD.COMPANY_CODE = AC.COMPANY_CODE
WHERE
    (
        (BD.CAL_ACCTG_PERIOD >= @PRIOR_PERIOD AND BD.CAL_ACCTG_PERIOD <= @CURRENT_PERIOD)
        AND A.ACCTG_BASIS_CODE = @BASIS1
        AND BD.COMPANY_CODE = @COMPANY_CODE
        AND BD.ACCOUNT_NUMBER BETWEEN '987564' AND '999999'
    )
    OR
    (
        (BD.CAL_ACCTG_PERIOD >= @PRIOR_PERIOD2 AND BD.CAL_ACCTG_PERIOD <= @CURRENT_PERIOD)
        AND A.ACCTG_BASIS_CODE = @BASIS1
        AND BD.COMPANY_CODE = @COMPANY_CODE
        AND BD.ACCOUNT_NUMBER BETWEEN '888888' AND '999888'
    )
    OR
    (
        (BD.CAL_ACCTG_PERIOD >= @PRIOR_PERIOD2 AND BD.CAL_ACCTG_PERIOD <= @CURRENT_PERIOD)
        AND A.ACCTG_BASIS_CODE = @BASIS1
        AND BD.COMPANY_CODE = @COMPANY_CODE
        AND BD.ACCOUNT_NUMBER BETWEEN '888888' AND '999888'
    )
    OR
    (
        (BD.CAL_ACCTG_PERIOD >= @PRIOR_PERIOD AND BD.CAL_ACCTG_PERIOD <= @CURRENT_PERIOD)
        AND A.ACCTG_BASIS_CODE = @BASIS1
        AND BD.COMPANY_CODE = @COMPANY_CODE
        AND BD.ACCOUNT_NUMBER BETWEEN '555555' AND '666666'
    )
GROUP BY
    BD.CAL_ACCTG_PERIOD,
    BD.COMPANY_CODE,
    BD.ACCOUNT_NUMBER,
    AC.DESCRIPTION,
    BH.STATUS_CODE,
    A.ACCTG_BASIS_CODE
ORDER BY
    BD.ACCOUNT_NUMBER,
    BD.CAL_ACCTG_PERIOD;

============================
SP=============
===============
CREATE PROCEDURE GetFinancialData
    @PRIOR_PERIOD INT,
    @CURRENT_PERIOD INT,
    @BASIS1 VARCHAR(50),
    @PRIOR_PERIOD2 INT,
    @COMPANY_CODE VARCHAR(50)
AS
BEGIN
    SET NOCOUNT ON;

    SELECT
        BD.CAL_ACCTG_PERIOD,
        BD.COMPANY_CODE,
        BD.ACCOUNT_NUMBER,
        AC.DESCRIPTION,
        SUM(BD.CONVERTED_AMOUNT) AS 'BALANCE',
        BH.STATUS_CODE,
        A.ACCTG_BASIS_CODE
    FROM
        BSTRN_HEADER BH
    INNER JOIN
        BSTRN_DETAIL BD ON BH.TRAN_ID = BD.TRAN_ID
    INNER JOIN
        ACCT_BAS_ACCT_BAS A ON BD.ACCTG_BASIS_CODE = A.REL_ACCT_BAS_CODE
    FULL OUTER JOIN
        ACCOUNT AC ON BD.ACCOUNT_NUMBER = AC.ACCT_NUMBER AND BD.COMPANY_CODE = AC.COMPANY_CODE
    WHERE
        (
            (BD.CAL_ACCTG_PERIOD >= @PRIOR_PERIOD AND BD.CAL_ACCTG_PERIOD <= @CURRENT_PERIOD)
            AND A.ACCTG_BASIS_CODE = @BASIS1
            AND BD.COMPANY_CODE = @COMPANY_CODE
            AND BD.ACCOUNT_NUMBER BETWEEN '987564' AND '999999'
        )
        OR
        (
            (BD.CAL_ACCTG_PERIOD >= @PRIOR_PERIOD2 AND BD.CAL_ACCTG_PERIOD <= @CURRENT_PERIOD)
            AND A.ACCTG_BASIS_CODE = @BASIS1
            AND BD.COMPANY_CODE = @COMPANY_CODE
            AND BD.ACCOUNT_NUMBER BETWEEN '888888' AND '999888'
        )
        OR
        (
            (BD.CAL_ACCTG_PERIOD >= @PRIOR_PERIOD2 AND BD.CAL_ACCTG_PERIOD <= @CURRENT_PERIOD)
            AND A.ACCTG_BASIS_CODE = @BASIS1
            AND BD.COMPANY_CODE = @COMPANY_CODE
            AND BD.ACCOUNT_NUMBER BETWEEN '888888' AND '999888'
        )
        OR
        (
            (BD.CAL_ACCTG_PERIOD >= @PRIOR_PERIOD AND BD.CAL_ACCTG_PERIOD <= @CURRENT_PERIOD)
            AND A.ACCTG_BASIS_CODE = @BASIS1
            AND BD.COMPANY_CODE = @COMPANY_CODE
            AND BD.ACCOUNT_NUMBER BETWEEN '555555' AND '666666'
        )
    GROUP BY
        BD.CAL_ACCTG_PERIOD,
        BD.COMPANY_CODE,
        BD.ACCOUNT_NUMBER,
        AC.DESCRIPTION,
        BH.STATUS_CODE,
        A.ACCTG_BASIS_CODE
    ORDER BY
        BD.ACCOUNT_NUMBER,
        BD.CAL_ACCTG_PERIOD;
END;

