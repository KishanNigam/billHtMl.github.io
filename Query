SELECT DISTINCT
        	HDR.REFERENCE_DATA AS invoice_number, 
		  '' AS voucher_no, 
 		  RIGHT(HDR.REFERENCE_DATA, LEN(HDR.REFERENCE_DATA) - 2) AS vendor_id, 
 		  '' AS vendor_name, 
 		  '' AS payment_name, 
 			APSTAT.CHECK_NUMBER AS payment_number, 
 		  APHDR.CHECK_DATE AS payment_date, 
 		  APHDR.CHECK_AMT AS paid_amount, 
 		  '' AS discount_taken_amount, 
 		  '' AS late_charge_amount, 
 		  '' AS notes, 
 		  APHDR.PAYMENT_MODE AS payment_method, 
 		  '' AS vendor_invoice_number, 
 		  '' AS payment_id 
	 FROM [eas].[dbo].[AP_CHECK_STATUS] 	APSTAT
	 JOIN (SELECT [TRAN_ID] 
	 			,CASE WHEN [CHECK_NUMBER]='' THEN EFT_ADVICE_NUM ELSE CHECK_NUMBER END AS CHKNO	
	 			,[COMPANY_CODE] ,[CHECK_RECON_DATE] ,[CHECK_DATE] ,[CHECK_AMT] 
	 			,[PAYMENT_MODE] ,[BANK] ,[BANK_ACCOUNT] ,[VENDOR_NAME1] 
	 		FROM [eas].[dbo].[AP_BSTRN_HEADER] 
	 		WHERE CHECK_RECON_STATUS IN ('O','C','V')) 	AS APHDR 
	 	ON APHDR.COMPANY_CODE=APSTAT.COMPANY_CODE 
	 	AND APHDR.BANK=APSTAT.BANK 
	 	AND APHDR.BANK_ACCOUNT=APSTAT.BANK_ACCOUNT 
	 	AND APHDR.CHKNO = APSTAT.CHECK_NUMBER 
	 JOIN BSTRN_HEADER 	HDR 
	 	ON HDR.TRAN_ID = APHDR.TRAN_ID 
	 	AND HDR.SOURCE_CODE IN ('APRRG')	
		AND APHDR.COMPANY_CODE = 'NICO' 
		AND APHDR.PAYMENT_MODE = 'E' 
		AND APHDR.VENDOR_NAME1 <> '' 
		AND HDR.REFERENCE_DATA like 'INV%' 
	 LEFT JOIN XPORT_AP_TRIGGER 	T 
	 	ON T.BANK = APSTAT.BANK	
	 	AND T.BANK_ACCOUNT = APSTAT.BANK_ACCOUNT 
	 	AND T.CHECK_NUMBER = APSTAT.CHECK_NUMBER 
	 	AND T.CHECK_RECON_STATUS = APSTAT.CHECK_RECON_STATUS 
	 WHERE T.XPORT_AP_ID NOT IN 
	 	(SELECT T.XPORT_AP_ID FROM XPORT_AP_TRIGGER T 
	 		JOIN XPORT_AP_CONTROL C	
	 		ON C.XPORT_AP_ID = T.XPORT_AP_ID 
	 		AND C.EXPORT_PROCESS = 'APRRGCHK') 
  
